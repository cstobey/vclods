SET SESSION binlog_format='ROW';
CREATE TEMPORARY TABLE tmp (
  a_id INT UNSIGNED NULL DEFAULT NULL,
  name VARCHAR(50) NOT NULL,
  is_happy TINYINT(1) UNSIGNED NOT NULL DEFAULT 1,
  KEY (name)
) ENGINE=InnoDB;
#RESET
#start INSERT INTO tmp (name,is_happy) VALUES
("some data goes here")
#RESET

UPDATE a JOIN tmp ON tmp.name<=>a.name SET tmp.a_id=a.a_id;
UPDATE a JOIN tmp ON tmp.a_id=a.a_id SET a.is_happy=IFNULL(tmp.is_happy,a.is_happy);
INSERT INTO a (name,is_happy)
  SELECT name,is_happy
  FROM tmp
  WHERE tmp.a_id IS NULL
  GROUP BY name;
UPDATE a JOIN tmp ON tmp.name<=>a.name SET tmp.a_id=a.a_id;
DELETE FROM a WHERE
  a_id NOT IN (SELECT tmp.a_id FROM tmp);
INSERT INTO b (a_id,a_name)
  SELECT a_id,name
  FROM tmp
  WHERE a_id NOT IN (SELECT a_id FROM b)
  GROUP BY a_id;
UPDATE c JOIN tmp ON  SET c.is_happy=IFNULL(tmp.is_happy,c.is_happy);
INSERT INTO c (is_happy)
  SELECT is_happy
  FROM tmp;
